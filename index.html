<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carte du Monde avec D3.js</title>
    <style>
      path {
        fill: #6b0000; /* Rouge foncé */
        stroke: #fff;
        stroke-width: 1;
      }

      .legend {
        font-size: 12px;
      }

      .legend rect {
        width: 18px;
        height: 18px;
        margin-right: 4px;
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script>
      var largeur = 1500;
      var hauteur = 1000;

      var projection = d3
        .geoMercator()
        .scale(((largeur + 1) / 2 / Math.PI) * 0.7)
        .translate([largeur / 2, hauteur / 2])
        .precision(0.1)
        .center([0, 0]);

      var chemin = d3.geoPath().projection(projection);

      var svg = d3
        .select("body")
        .append("svg")
        .attr("width", largeur)
        .attr("height", hauteur);

      d3.csv("FAOSTAT_data_en_1-11-2024.csv").then(function (donnees) {
        d3.json("custom.geo.json").then(function (monde) {
          monde.features.forEach(function (paysMonde) {
            var donneesPays = donnees.find(function (csvPays) {
              return csvPays["Area"] === paysMonde.properties.name;
            });
            if (donneesPays) {
              paysMonde.properties.data = donneesPays;
            }
          });

          var echelleCouleur = d3.scaleSequential(d3.interpolateReds).domain([
            d3.min(donnees, function (d) {
              return +d.Value;
            }),
            d3.max(donnees, function (d) {
              return +d.Value;
            }),
          ]);

          svg
            .selectAll("path")
            .data(monde.features)
            .enter()
            .append("path")
            .attr("d", chemin)
            .style("fill", function (d) {
              return d.properties.data
                ? echelleCouleur(+d.properties.data.Value)
                : "#6b0000";
            })
            .style("stroke", "#fff")
            .style("stroke-width", 1);

          // Légende
          var legende = svg
            .selectAll(".legende")
            .data(echelleCouleur.ticks(6).slice(1))
            .enter()
            .append("g")
            .attr("class", "legende")
            .attr("transform", function (d, i) {
              return "translate(0," + (hauteur - 20 - i * 20) + ")";
            });

          legende
            .append("rect")
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", echelleCouleur);

          legende
            .append("text")
            .attr("x", 26)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "start")
            .text(function (d) {
              return "≥ " + Math.round(d);
            });
        });
      });
    </script>
  </body>
</html>
